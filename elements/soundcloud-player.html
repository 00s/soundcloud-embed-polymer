<link rel="import" href="../bower_components/polymer/polymer.html">

<polymer-element name="soundcloud-player" attributes="track-id playlist-id color auto-play show-artwork">
  <template>
    <style>
      :host .soundcloud-embed {
        border: none;
        overflow: hidden;
        width: 100%;
      }
      :host .soundcloud-song {
        height: 166px;
      }
      :host .soundcloud-playlist {
        height: 450px;
      }
    </style>

    <iframe class="soundcloud-embed {{ cssClass }}" src="{{ playerUrl }}"></iframe>
  </template>

  <script>
    Polymer('soundcloud-player', {
      "color": 'ff6600',
      "auto-play": false,
      "show-artwork": true,

      ready: function() {
        if(this["track-id"]) {
          this.isTrack = true;
          this.cssClass = "soundcloud-song";
        }
        else if(this["playlist-id"]) {
          this.isPlaylist = true;
          this.cssClass = "soundcloud-playlist";
        }
        else {
          throw new Error("SoundCloud player requires either a `track-id` or `playlist-id` value.");
        }
        this.playerUrl = this.getPlayerUrl();
      },

      getPlayerUrl: function() {
        var params = {
          url: this.getApiUrl(),
          color: this.color,
          auto_play: this["auto-play"],
          show_artwork: this["show-artwork"]
        };
        var paramPairs = [];
        for(var key in params) {
          paramPairs.push(key + "=" + encodeURIComponent(params[key]));
        }
        return "https://w.soundcloud.com/player/?" + paramPairs.join("&amp;");
      },

      getApiUrl: function() {
        var url = "https://api.soundcloud.com/";
        if(this.isTrack) {
          url += "tracks/" + this["track-id"];
        }
        else {
          url += "playlists/" + this["playlist-id"];
        }
        return url;
      }
    });
  </script>
</polymer-element>
